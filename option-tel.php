<?php/** * *来客信息汇总界面，只有管理员有权限 * * @uses add_theme_page()    * @uses add_action() * * @return html */function limiwu_saveTel_setting(){  add_theme_page(__('来客信息汇总','limiwu'),__('来客信息汇总','limiwu'), 'administrator', 'saveTel_setting_administrator','limiwu_saveTel_page');}   add_action('admin_menu', 'limiwu_saveTel_setting');/** * 查询数据库，返回来客的电话及相关信息 * * @package limiwuCom * @author annanzi/910109610@qq.com * @since 2019-11-10 * @return array */function limiwu_select_tel(){    global $wpdb;    $i = 0;       $table_name = $wpdb->prefix . "teltable";    $table_name = $wpdb->escape($table_name);    $sql = $wpdb->get_results("SELECT * FROM $table_name order by `time` DESC LIMIT 50");    if (empty($sql)) {      return;    }else{      return $sql;    }}/** * 更新teltable数据库表中的内容，有就更新，没有返回 * * @package limiwuCom * @author annanzi/910109610@qq.com * @since 2019-12-7 */function limiwu_update_telTable($id,$name,$tel,$address,$state){    global $wpdb;    $id = $wpdb->escape($id);    $name = $wpdb->escape($name);    $tel = $wpdb->escape($tel);    $address = $wpdb->escape($address);    $state = $wpdb->escape($state);    $table_name = $wpdb->prefix . "telTable";    $table_name = $wpdb->escape($table_name);    $wpdb->update(        $table_name,        array(          'name' => $name,          'address' => $address,          'tel' => $tel,          'state' => $state        ),        array(          'id' => $id        )    );}/** * 删除teltable表的数据 * * @package limiwuCom * @author annanzi/910109610@qq.com * @since 2019-12-7 */function limiwu_del_telTable($id){    global $wpdb;    $id = $wpdb->escape($id);    $table_name = $wpdb->prefix . "telTable";    $wpdb->query("DELETE FROM $table_name WHERE `id` = $id");}/** * 输出收藏的图片 */function limiwu_saveTel_page(){  // 更新数据  if ($_POST['limiwu_tel_button'] == 'Update') {    limiwu_update_telTable($_POST['limiwu_tel_id'],$_POST['limiwu_tel_name'],$_POST['limiwu_tel_tel'],$_POST['limiwu_tel_address'],$_POST['limiwu_tel_state']);  }  // 删除数据  if ($_POST['limiwu_tel_button'] == 'Del') {    limiwu_del_telTable($_POST['limiwu_tel_id']);  }  // 查询数据  $arr = limiwu_select_tel();  // 输出查询信息  $return = '<h2>'.__('来访客源','limiwu').'</h2><hr>';  $return .= '<table class="teltable"><tr><th width="8%">ID</th><th>delete</th><th>Time</th><th>Name</th><th>Telephone</th><th>address</th><th>state</th><th>Update</th></tr>';  foreach ($arr as $key) {    $return .= '<tr><form method="POST" action="'.admin_url().'themes.php?page=saveTel_setting_administrator">';    $return .= '<th><input name="limiwu_tel_id" type="number" value="'.$key->id.'" readonly unselectable="on"></th>';    $return .= '<td><input name="limiwu_tel_button" type="submit" class="button button-default" value="Del"></td>';    $return .= '<th>'.$key->time.'</th>';    $return .= '<td><input name="limiwu_tel_name" type="text" value="'.$key->name.'"></td>';    $return .= '<td><input name="limiwu_tel_tel" type="number" value="'.$key->tel.'"></td>';    $return .= '<td><input name="limiwu_tel_address" type="text" value="'.$key->address.'"></td>';    $return .= '<td><input name="limiwu_tel_state" type="text" value="'.$key->state.'"></td>';    $return .= '<td><input name="limiwu_tel_button" type="submit" class="button button-primary" value="Update"></td>';    $return .= '</form></tr>';  }  $return .= '</table>';  echo $return;}?>